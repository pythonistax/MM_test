# Server Operations Guide

## 1. Connecting to Server
```bash
ssh root@65.20.111.151
```
scp pull: 
scp -r root@65.20.111.151:/root/mm_bot/* .

scp push:
scp -r ./* root@65.20.111.151:/root/mm_bot/

scp pulling the databases:
scp root@65.20.111.151:/root/mm_bot/*.xlsx .



Password
T?7hQL7zqpw_S3B#

## 2. Daily Bot Startup Procedure
```bash
# Start virtual display
Xvfb :99 -screen 0 1024x768x24 &

# Set display environment
export DISPLAY=:99

# Navigate to bot directory
cd /root/mm_bot
```

## 2a. Running the Bot in the Background (Recommended: nohup)
```bash
# 1. Stop any running bot processes (clean start)
pkill -f chat_logger.py

# 2. Check if any bot processes exist (should see none except the grep command)
ps aux | grep chat_logger

# 3. Go to the bot directory
cd /root/mm_bot

# 4. Start the bot in the background with nohup (using venv Python)
nohup xvfb-run --server-num=99 venv/bin/python3 chat_logger.py > bot.log 2>&1 &


ON SCREEN (if you want to see output directly): 
   cd /root/mm_bot
   source venv/bin/activate
   xvfb-run --server-num=99 python3 chat_logger.py

# 5. Verify it's running in the background
ps aux | grep python3

# 6. Check the logs to make sure it's working
tail -f bot.log
# OR check the Python logger output:
tail -f agent_serv_si.log
# (Press Ctrl+C to stop viewing the log, the bot keeps running)

# 7. Safely exit SSH
exit
```
- The bot will keep running in the background after you disconnect or turn off your laptop.
- All output will be saved to `bot.log` (nohup) and `agent_serv_si.log` (Python logger).
- To stop the bot later, use `pkill -f chat_logger.py`.

## 2b. Checking if the Bot is Running
```bash
# SSH into your server
ssh root@65.20.111.151

# Check if the bot process is running
ps aux | grep chat_logger.py
# If you see a line with 'python3 chat_logger.py', your bot is running.

# Check the latest log output
cd /root/mm_bot
tail -f bot.log
# OR check the Python logger:
tail -f agent_serv_si.log
# (Press Ctrl+C to stop viewing the log)
```

## 3. Managing Background Sessions

### Using Screen (Recommended)
```bash
# Create new screen session
screen -S bot_session

# List all screen sessions
screen -ls

# Reattach to existing session
screen -r bot_session

# Detach from screen (while in session)
# Press Ctrl+A then D

# Kill a screen session
screen -X -S bot_session quit
```

### Using Nohup
```bash
# Check if bot is running
ps aux | grep python

# View nohup output
tail -f bot_output.log
```

## 4. File Transfer Commands

### Uploading Files to Server
```bash
# Single file upload
scp /path/to/local/file root@65.20.111.151:/path/on/server

# Upload entire directory
scp -r /path/to/local/directory root@65.20.111.151:/path/on/server
```

### Downloading Files from Server
```bash
# Download single file
scp root@65.20.111.151:/path/on/server/file /path/to/local/directory

# Download entire directory
scp -r root@65.20.111.151:/path/on/server/directory /path/to/local/directory
```

## 5. Checking Bot Status
```bash
# Check if bot is running
ps aux | grep python

# Check if virtual display is running
ps aux | grep Xvfb

# Check bot logs
tail -f bot.log
# OR check the Python logger:
tail -f agent_serv_si.log

# Check screen sessions
screen -ls
```

## 6. Stopping the Bot
```bash
# If using screen:
screen -r bot_session
# Then press Ctrl+C to stop the bot
# Then type 'exit' to close the screen session

# If using nohup:
# Find bot process
ps aux | grep python
# Kill the process (replace PID with actual process ID)
kill PID

# Stop virtual display
pkill Xvfb
```

## 7. Common Issues and Solutions

### If virtual display isn't working:
```bash
# Kill any existing Xvfb processes
pkill Xvfb

# Start fresh
Xvfb :99 -screen 0 1024x768x24 &
export DISPLAY=:99
```

### If bot won't start:
```bash
# Check Python version
python --version

# Check if all dependencies are installed
pip list

# Check disk space
df -h

# Check memory usage
free -h
```

## 8. Backup Procedures
```bash
# Create backup of bot directory
tar -czf bot_backup_$(date +%Y%m%d).tar.gz /path/to/bot/directory

# Download backup to local machine
scp root@65.20.111.151:/path/to/backup/bot_backup_*.tar.gz /local/backup/directory
```

## 9. Log Management
```bash
# View recent logs (nohup output)
tail -f bot.log

# View Python logger output
tail -f agent_serv_si.log

# Clear old logs (if needed)
truncate -s 0 bot.log
truncate -s 0 agent_serv_si.log
```

## Important Notes:
1. Always backup before making changes
2. Keep track of any custom configurations
3. Monitor disk space regularly
4. Check logs for errors
5. Keep the server's system updated
6. Use screen or nohup to keep the bot running after disconnecting
7. Regularly check if the bot is still running

## Emergency Contacts:
- System Administrator: [Add contact]
- Bot Developer: [Add contact]
- Server Provider: [Add contact] 

## 10. Initial Setup: Push Files and Install Requirements

### Step 1: Push all files to server
```bash
# Navigate to your local project directory (where your Python scripts and Excel file are)
cd "C:\Users\mmsou\Documents\Valerius Labs\Clients\MM\MM test"

# Push all files at once (safer - explicit file list)
scp bank_statement_retriever_and_organizer.py chat_logger.py CRM_report_integrator_with_bank_statements.py MM_DEPREC_playwright.py GWID_MM.xls MM_requirements.txt MM_requirements_production.txt server_setup.sh SERVER_SETUP.md root@65.20.111.151:/root/mm_bot/
```

### Step 2: SSH into server and install requirements
```bash
# Connect to server
ssh root@65.20.111.151

# Navigate to mm_bot directory
cd /root/mm_bot

# FIRST: Install python3-venv package (required for virtual environment)
sudo apt update
sudo apt install -y python3-venv python3-pip

# Create virtual environment
python3 -m venv venv

# Activate virtual environment
source venv/bin/activate

# You should now see (venv) in your prompt

# Upgrade pip
pip install --upgrade pip

# Install all requirements (use production for server)
pip install -r MM_requirements_production.txt

# Install Playwright system dependencies
playwright install chromium-deps

# Install Playwright browsers (this takes several minutes)
playwright install chromium

# Verify installation
python3 -c "import playwright; print('✅ Playwright installed successfully!')"
```

### Step 2a: If virtual environment creation failed (FIX)
```bash
# If you already tried and venv creation failed, run these commands:
cd /root/mm_bot

# Install python3-venv package
sudo apt install -y python3-venv python3-pip

# Remove old venv directory if it exists (it's broken)
rm -rf venv

# Create fresh virtual environment
python3 -m venv venv

# Activate it
source venv/bin/activate

# Now install requirements in the venv
pip install --upgrade pip
pip install -r MM_requirements_production.txt

# Install Playwright
playwright install chromium-deps
playwright install chromium

# Verify
python3 -c "import playwright; print('✅ Playwright installed successfully!')"
```


NEW SERVER PROCESS 
# 1. Update system and install Python venv
sudo apt update
sudo apt install python3-venv python3-pip

# 2. Create and activate virtual environment
cd /root/mm_bot
python3 -m venv venv
source venv/bin/activate

# 3. Install Python packages
pip install --upgrade pip
pip install -r MM_requirements_production.txt

# 4. Install Playwright system dependencies
playwright install chromium-deps

# 5. Install Playwright browsers
playwright install chromium

# 6. Install additional system dependencies for virtual display
sudo apt install -y xvfb

# 7. Setup virtual display
sudo pkill Xvfb || true
Xvfb :99 -screen 0 1920x1080x24 -ac -nolisten tcp &
export DISPLAY=:99

# 8. Test Playwright
python3 -c "from playwright.sync_api import sync_playwright; print('✅ Playwright installed successfully!')"